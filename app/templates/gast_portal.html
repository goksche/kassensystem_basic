<!-- kassensystem_basic/app/templates/gast_portal.html -->
{% extends "base.html" %}
{% block content %}
<h2 class="text-xl font-semibold mb-4">Gast-Portal</h2>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
  <section class="bg-white border rounded-2xl p-4">
    <h3 class="font-semibold mb-2">Meine Daten finden</h3>
    <div class="flex items-center gap-2">
      <input id="q" type="text" class="border rounded-lg px-3 py-2 w-full" placeholder="Name, Telefon oder E-Mail">
      <button id="btn" class="px-3 py-2 rounded-lg border">Suchen</button>
    </div>
    <div id="result" class="mt-3 text-sm"></div>
  </section>

  <section class="bg-white border rounded-2xl p-4">
    <h3 class="font-semibold mb-2">Angebot (Preise inkl. MWST)</h3>
    <div class="grid grid-cols-2 gap-2">
      <div>
        <h4 class="font-medium mb-1">Services</h4>
        <div id="svc" class="space-y-1 text-sm"></div>
      </div>
      <div>
        <h4 class="font-medium mb-1">Produkte</h4>
        <div id="prod" class="space-y-1 text-sm"></div>
      </div>
    </div>
  </section>
</div>

<script>
function fmt(x){ return 'CHF ' + Number(x).toFixed(2); }
async function loadCatalog(){
  const s = await (await fetch('/api/katalog/services')).json();
  const p = await (await fetch('/api/katalog/produkte')).json();
  const svcd = document.getElementById('svc'); svcd.innerHTML='';
  s.forEach(i => { const d=document.createElement('div'); d.className='flex justify-between'; d.innerHTML=`<span>${i.name}</span><span>${fmt(i.preis)}</span>`; svcd.appendChild(d); });
  const prodd = document.getElementById('prod'); prodd.innerHTML='';
  p.forEach(i => { const d=document.createElement('div'); d.className='flex justify-between'; d.innerHTML=`<span>${i.name}</span><span>${fmt(i.preis)}</span>`; prodd.appendChild(d); });
}
async function search(){
  const q = document.getElementById('q').value.trim();
  const res = await fetch('/api/kunden?q=' + encodeURIComponent(q));
  const data = await res.json();
  const r = document.getElementById('result'); r.innerHTML='';
  if(!data.length){ r.innerHTML='<div class="text-gray-500">Keine Treffer.</div>'; return; }
  data.slice(0,5).forEach(k=>{
    const row=document.createElement('div'); row.className='border rounded-xl p-2 mb-1';
    row.innerHTML = `<div class="font-medium">${k.name}</div><div class="text-xs text-gray-500">${k.telefon || ''} ${k.email ? 'â€¢ '+k.email : ''}</div>`;
    r.appendChild(row);
  });
}
document.getElementById('btn').onclick = search;
loadCatalog();
</script>
{% endblock %}
